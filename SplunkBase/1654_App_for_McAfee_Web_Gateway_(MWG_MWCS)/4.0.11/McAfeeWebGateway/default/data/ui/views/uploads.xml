<?xml version="1.0"?>
<form version="1.1">
  <label>Uploads</label>
  <fieldset>
    <input type="text" token="user">
      <label>User</label>
      <default/>
      <prefix>user=</prefix>
      <initialValue/>
    </input>
    <input type="text" token="src">
      <label>Src IP</label>
      <default/>
      <prefix>src=</prefix>
      <initialValue/>
    </input>
    <input type="text" token="dest">
      <label>Dest</label>
      <default/>
      <prefix>dest=</prefix>
      <initialValue/>
    </input>
    <input type="text" token="http_user_agent">
      <label>User-Agent</label>
      <default/>
      <prefix>http_user_agent=</prefix>
      <initialValue/>
    </input>
    <input type="multiselect" token="action" searchWhenChanged="true">
      <default>allowed,blocked,auth,error</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>action="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <choice value="allowed">allowed</choice>
      <choice value="blocked">blocked</choice>
      <choice value="auth">auth</choice>
      <choice value="error">error</choice>
      <label>Action</label>
    </input>
    <input type="dropdown" token="max_lines" searchWhenChanged="true">
      <default>5</default>
      <valuePrefix>max_lines="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <choice value="5">5</choice>
      <choice value="10">10</choice>
      <choice value="20">20</choice>
      <choice value="100">100</choice>
      <choice value="1000">1000</choice>
      <label>Max lines per Row</label>
    </input>
    <input type="time" searchWhenChanged="false">
      <default>
        <earliest>-30m</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <table>
      <title>Uploads</title>
      <search>
        <query> `index_and_sourcetype` $user$ $src$ $dest$ $http_user_agent$ $action$ uploads=* | fields src http_user_agent action category bytes_out web_reputation url uploads ensured_mediatypes http_content_types | makemv delim="," uploads | eval mediatypes=coalesce(ensured_mediatypes, http_content_type ) | makemv delim="," mediatypes | stats count dc(src) AS #src dc(http_user_agent) AS #http_user_agent values(action) AS action values(category) AS categories values(bytes_out) AS bytes_out values(web_reputation) AS web_reputation values(uploads) AS file_name, values(mediatypes) AS content_type by url | eval file_name_count=(mvcount(file_name)) | eval more=file_name_count - $max_lines$ |eval file_name=if(file_name_count &gt; $max_lines$, mvappend(mvindex(file_name,1,$max_lines$), more . " more.."), file_name) | fields - more, file_name_count | rename file_name AS "upload_file | size"</query>
      </search>
      <option name="wrap">true</option>
      <option name="rowNumbers">true</option>
      <option name="dataOverlayMode">none</option>
      <option name="drilldown">row</option>
      <option name="count">10</option>
    </table>
  </row>
</form>
