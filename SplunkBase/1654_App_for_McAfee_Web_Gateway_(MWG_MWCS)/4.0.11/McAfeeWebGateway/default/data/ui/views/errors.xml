<?xml version="1.0"?>
<form version="1.1">
  <label>Errors</label>
  <fieldset>
    <input type="text" token="user">
      <label>User</label>
      <default/>
      <prefix>user=</prefix>
      <initialValue/>
    </input>
    <input type="text" token="src">
      <label>Src IP</label>
      <default/>
      <prefix>src=</prefix>
      <initialValue/>
    </input>
    <input type="text" token="dest">
      <label>Dest</label>
      <default/>
      <prefix>dest=</prefix>
      <initialValue/>
    </input>
    <input type="text" token="http_user_agent">
      <label>User-Agent</label>
      <default/>
      <prefix>http_user_agent=</prefix>
      <initialValue/>
    </input>
    <input type="multiselect" token="action" searchWhenChanged="true">
      <default>allowed,auth,error</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>action="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <choice value="allowed">allowed</choice>
      <choice value="blocked">blocked</choice>
      <choice value="auth">auth</choice>
      <choice value="error">error</choice>
      <label>Action</label>
    </input>
    <input type="dropdown" token="max_lines" searchWhenChanged="true">
      <default>5</default>
      <valuePrefix>max_lines="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <choice value="10">10</choice>
      <choice value="20">20</choice>
      <choice value="100">100</choice>
      <choice value="1000">1000</choice>
      <label>Max lines per Row</label>
    </input>

    <input type="checkbox" token="timers" searchWhenChanged="true">
      <default></default>
      <choice value="avg(t_dns) AS avgDNS, median(t_dns) AS medDNS, avg(t_connect) AS avgConnect, median(t_connect) AS medConnect, avg(t_lslrs) AS avgLSLRS, median(t_lslrs) AS medLSLRS, avg(duration) AS avgDuration, median(duration) AS medDuration, avg(connection_runtime) AS connRunTime, median(connection_runtime) AS medConnRunTime">show Timers</choice>
      <label>Timers</label>
    </input>

    <input type="checkbox" token="url_info" searchWhenChanged="true">
      <default></default>
      <choice value="values(category) AS category, values(web_reputation) AS reputation">show URL Info</choice>
      <label>URL Info</label>
    </input>

    <input type="checkbox" token="by_connection" searchWhenChanged="true">
      <default></default>
      <choice value="by_connection">break by connection</choice>
      <label>Connection</label>
    </input>



    <input type="time" searchWhenChanged="false">
      <default>
        <earliest>-30m</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <table>
      <title>Error  Analysis</title>
      <search>
        <query> `index_and_sourcetype` $user$ $src$ $dest$ $http_user_agent$ $action$ protocol_failure_description=* | eval by_connection= src_ip.":".src_port."->".dest.":".dest_port | fields action status bytes_in bytes_out block_id url url_protocol http_method error_id error_template error_message protocol_failure_description t_dns t_connect duration t_lslrs dest_port connection_runtime category web_reputation by_connection | stats   count, values(bytes_in) AS bytes_in values(bytes_out) AS bytes_out values(status) AS status values(action) AS action values(url_protocol) AS url_protocol values(dest_port) AS dest_port values(http_method) AS http_method values(block_id) AS block_id values(error_id) AS error_id $timers$ $url_info$ values(error_template) AS Message_Template values(error_message) AS error_message, values(url) AS url by protocol_failure_description $by_connection$ | eval avgDNS=round(avgDNS) | eval avgConnect=round(avgConnect) | eval avgDuration=round(avgDuration) | eval avgLSLRS=round(avgLSLRS) | eval avgConnRuntime=round(connRunTime) | eval url_count=(mvcount(url)) | eval more=url_count - $max_lines$ |eval url=if(url_count &gt; $max_lines$, mvappend(mvindex(url,1,$max_lines$), more . " more.."), url) | fields - more, url_count | sort - count</query>
      </search>
    </table>
  </row>
</form>
