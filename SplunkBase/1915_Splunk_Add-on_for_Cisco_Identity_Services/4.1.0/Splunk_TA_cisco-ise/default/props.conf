##
## SPDX-FileCopyrightText: 2021 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-1-2020
##
##

[cisco:ise]
rename=cisco:ise:syslog
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
DATETIME_CONFIG = CURRENT


[cisco:ise:syslog]
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
DATETIME_CONFIG = CURRENT
KV_MODE = none

# Extractions
EXTRACT-provisioning = Client\sProvisioning:\s+Client\sprovisioning\s(?<provisioning_action>\w+)
EXTRACT-query = OperationMessageText\s*=\s*(.+)\s+hostname\s+(?<query>\S+)
EXTRACT-dest_name = HostID\s*=\s*Internal\s*CA:\s*(?<dest_name>[^,]*)

# Reports
REPORT-cisco-ise-raw-message = cisco-ise-extract-raw-message
REPORT-cisco-ise-type-servername = cisco-ise-type, cisco-ise-servername
REPORT-cisco-ise-tunnel-private-group-id = cisco-ise-tunnel-private-group-id
REPORT-cisco-ise-action-failure-for-auth = cisco-ise-action-failure-for-auth
REPORT-cisco-ise-action-success-for-auth = cisco-ise-action-success-for-auth
REPORT-cisco-ise-action-blocked = cisco-ise-action-blocked
REPORT-cisco-ise-action-allowed = cisco-ise-action-allowed
REPORT-cisco-ise-action-unknown = cisco-ise-action-unknown
REPORT-cisco-ise-field-action-auth = cisco_ise_field_action, cisco-ise-vendor-action-for-auth
REPORT-cisco-ise-raw-operation-message-text = cisco-ise-raw-message, cisco-ise-operation-message-text
REPORT-cisco-ise-open-ssl-err-msg =  cisco-ise-open-ssl-err-msg
REPORT-cisco-ise-operation-counters = cisco-ise-operation-counters
REPORT-cisco-ise-calling-station-id = cisco-ise-calling-station-id
REPORT-cisco-ise-called-station-id = cisco-ise-called-station-id
REPORT-cisco-ise-service-58001 = cisco-ise-service-58001
REPORT-cisco-ise-traffic-fields = cisco-ise-traffic-ports-hosts

# Aliases
FIELDALIAS-system-mgmt-desc = System_Management AS system_mgmt_desc
FIELDALIAS-reason = FailureReason AS reason
FIELDALIAS-cisco-ise-src_int = NAS_Port_Id AS src_int
FIELDALIAS-service_name = service as service_name

# Evals
EVAL-vendor = "Cisco"
EVAL-product = if(server_type == "CISE", "Identity Services Engine", "Secure Access Control System")
EVAL-app = case(MESSAGE_CODE IN("5434", "5435", "5449", "61027", "60188", "60081", "60082", "60185", "60116", "60206", "60115", "60205", "60184", "60165", "5206", "60125", "25006", "31107", "32005", "32018", "89003", "60093", "60095", "60227", "11015", "61026", "61025", "11504", "12307", "12304", "12305", "11520", "11815", "11810", "11823"),"Cisco ISE", MESSAGE_CODE IN("12508", "12514", "12516"),"EAP-TLS", MESSAGE_CODE IN("5400", "5411", "5200"), "Radius", MESSAGE_CODE IN("5201", "5202", "5203", "5401"), "Tacacs", MESSAGE_CODE IN("61076", "60075"), "Sponsor")
EVAL-id = case(MESSAGE_CODE IN("5434", "5435", "5449", "61027", "60125", "60165", "25006", "31107", "32005", "32018", "89003", "60093", "60095", "60227", "11015", "61026"),MESSAGE_CODE)
EVAL-type = case(MESSAGE_CODE IN("5434", "5435", "5449", "61027", "61026", "60125", "60165", "25006", "31107", "32005", "32018", "89003", "60093", "60095", "60227", "11015"), "event", true(), type)
EVAL-action = case(match(provisioning_action,"(?i)succeeded"),"created", MESSAGE_CODE IN("60461","60197"),"stopped", MESSAGE_CODE IN("52002","60132","60198"),"deleted", MESSAGE_CODE IN("60085","60086","60214","51100"),"modified", MESSAGE_CODE IN("58022","58024","58023","60131","5232","5233"),"created", MESSAGE_CODE IN("5400", "12516", "12514", "12508", "5411", "5405", "87501", "60188", "60081", "60082", "60185", "11504"),"failure",MESSAGE_CODE IN("5200", "5231", "61076", "60116", "60206", "60115", "60205", "60184", "60075", "12304", "12305", "11520", "11810","60190"),"success",MESSAGE_CODE IN ("61025"),"allowed",true(),action)
EVAL-session_id = coalesce(AcsSessionID,SessionId)
EVAL-cpu_load_percent = trim(SysStatsUtilizationCpu,"%")
EVAL-user = coalesce(OriginalUserName,UserName,User-Name,User_Name,Admin,AdminName,PortalUser,User, case(MESSAGE_CODE IN("60227", "60125", "60184", "60185", "60082", "60081", "60188"), "admin"))
EVAL-src = case(MESSAGE_CODE IN("60188", "60081"), replace(OperationMessageText, ".*(from\s+(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})+).*", "\2"), MESSAGE_CODE==61076, IpAddress, MESSAGE_CODE IN("60125", "60165", "60093", "60095", "61026"), host, MESSAGE_CODE IN("32018", "5449"), DestinationIPAddress, MESSAGE_CODE==61027, replace(OperationMessageText, ".*(?:DestinationIP\s*:\s*'?(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})'?).*", "\1"), MESSAGE_CODE IN ("11015", "11823", "11810", "11815", "11520", "12305", "12304", "12307", "11504", "5236"), Device_IP_Address, MESSAGE_CODE!=5434 AND MESSAGE_CODE!=5435,coalesce(replace(lower(src_mac),"-",":"),replace(lower(MacAddress),"-",":"),src_ip,src_host,Remote_Address,Framed_IP_Address,IpAddress,AdminIPAddress,Host,Device_IP_Address))
EVAL-src_ip = case(MESSAGE_CODE!=5434 AND MESSAGE_CODE!=5435,coalesce(src_ip,Remote_Address,Framed_IP_Address,IpAddress,AdminIPAddress,Host,Device_IP_Address))
EVAL-src_mac = replace(lower(coalesce(src_mac,MacAddress)),"-",":")
EVAL-dest_mac = replace(lower(dest_mac),"-",":")
EVAL-dest = case(MESSAGE_CODE IN("5434", "5435"),Framed_IP_Address, MESSAGE_CODE IN("5206", "11504", "12307", "12304", "12305", "11520", "11815", "11810", "11823", "11015", "5232", "5233"),DestinationIPAddress, MESSAGE_CODE IN("60093", "60095", "60165", "61027"), AdminIPAddress, MESSAGE_CODE==5449, Device_IP_Address, MESSAGE_CODE==89003, MDMServerName, MESSAGE_CODE==60125, replace(OperationMessageText, ".*(from\s+(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})+).*", "\2"), MESSAGE_CODE IN("5203", "5201", "5202", "5401", "5411", "11010", "34127", "34126", "58001", "58002", "58005", "91004", "91018", "60188", "60081", "60082", "60185", "60116", "60206", "60115", "60205", "60184", "60075", "60461", "52002", "60086", "58022", "58024", "58023", "60131", "60132", "60198", "60197", "60085", "60190", "60214", "51100"), host, MESSAGE_CODE==61076, PsnHostName, MESSAGE_CODE IN("87608", "87609", "87604"), dest_name,true(),coalesce(replace(lower(dest_mac),"-",":"),dest_ip,dest_host,EndpointIPAddress))
EVAL-body = case(MESSAGE_CODE==5434, "Endpoint conducted several failed authentications of the same scenario Could not locate Network Device or AAA Client", MESSAGE_CODE==5435, "NAS conducted several failed authentications of the same scenario Could not locate Network Device or AAA Client", true(), RADIUS)
EVAL-severity = case(x_status=="NOTICE","low",x_status=="WARN","medium",x_status=="INFO" OR x_status=="DEBUG","informational",x_status=="ERROR","high",x_status=="FATAL","critical")
EVAL-ise_servername = coalesce(ise_servername, host)
EVAL-dvc = coalesce(ise_servername, host)
EVAL-vendor_product = "Cisco " + if(server_type == "CISE", "Identity Services Engine", "Secure Access Control System")
EVAL-status = case(MESSAGE_CODE IN("11010", "34126", "58002", "58005", "60234", "87604", "87608"), "stopped", MESSAGE_CODE IN("34127", "58001", "11009", "25004", "34050", "13002", "32000", "60235", "87609", "91004", "91018"), "started", MESSAGE_CODE="87751", "warning", MESSAGE_CODE IN("60461","52002","60086","58022","58024","58023","60132","60131","60198","5233","60085","60190","5232","60197","60214","51100"), "success")
EVAL-start_mode = case(MESSAGE_CODE IN("11010", "34126", "58002", "58005", "60234", "87604", "87608", "91018", "87751"), "auto", MESSAGE_CODE IN("34127", "58001", "11009", "25004", "34050", "13002", "32000", "60235", "87609", "91004"), "manual")
EVAL-authentication_method = case(MESSAGE_CODE IN("11823", "11810", "11815", "11520", "12305", "12304", "12307", "11504"), EapAuthentication)
EVAL-src_user = coalesce(OriginalUserName,UserName,User-Name,User_Name,Admin,AdminName,PortalUser,User, case(MESSAGE_CODE IN("60227", "60125", "60184", "60185", "60082", "60081", "60188"), "admin"))
EVAL-user_name = coalesce(OriginalUserName,UserName,User-Name,User_Name,Admin,AdminName,PortalUser,User, case(MESSAGE_CODE IN("60227", "60125", "60184", "60185", "60082", "60081", "60188"), "admin"))
EVAL-object_id = case(MESSAGE_CODE IN ("60190","60197"),ObjectName)
EVAL-transport = case(MESSAGE_CODE IN ("61025"), "TCP")
EVAL-protocol = case(MESSAGE_CODE IN ("61025"), "IP")
EVAL-dest_port = coalesce(dest_port,DestinationPort)

# Lookups
LOOKUP-cisco-ise-message-catalog = cisco-ise-message-catalog-lookup MESSAGE_CODE OUTPUTNEW MESSAGE_CLASS, MESSAGE_TEXT, MESSAGE_TEXT as description, MESSAGE_TEXT as reason, MESSAGE_TEXT as body, MESSAGE_TEXT as signature_id
LOOKUP-cisco-ise-service = cisco-ise-service-lookup MESSAGE_CODE OUTPUTNEW SERVICE as service, SERVICE as service_name, MESSAGE_CODE as service_id
LOOKUP-cisco-ise-change = cisco-ise-change-lookup MESSAGE_CODE OUTPUT change_type,command,object,object_attrs,object_category,result

[syslog]
TRANSFORMS-cisco-ise = cisco-ise-sourcetype

[Cisco:ISE:Syslog]
rename = cisco:ise:syslog
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true