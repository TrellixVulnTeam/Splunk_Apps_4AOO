<form>
    <label>Top Charts</label>
    <description>Charts of the most frequent occurrences of sampled inbound network parameters as percentages of the samples.  Select a site and click Search.</description>
    <fieldset autoRun="false">
        <input type="dropdown" token="deployment">
            <label>Site</label>
            <populatingSearch fieldForValue="query" fieldForLabel="description">
                <![CDATA[| rest /services/authentication/current-context splunk_server=local | fields + username | lookup sites user as username OUTPUT user, description, query | append [ | rest /services/authentication/current-context splunk_server=local | eval username="all" | lookup sites user as username OUTPUT user, description, query ] | eval myzip=mvzip(description, query) | table myzip | mvexpand myzip | rex field=myzip "(?<description>[^,]+),(?<query>[^,]+)" | fields - myzip | sort description]]>
            </populatingSearch>
            <selectFirstChoice>true</selectFirstChoice>
        </input>

        <input type="time">
            <label>Time Frame</label>
            <default>
                <earliestTime>@d</earliestTime>
                <latestTime>now</latestTime>
            </default>
        </input>
        <input type="dropdown" token="mytz" depends="$hidden$">
            <label>mytz</label>
            <populatingSearch fieldForValue="tz">
                <![CDATA[index=* | head 1 | eval tz=strftime(_time,"%Z") | table tz]]>
            </populatingSearch>
            <selectFirstChoice>true</selectFirstChoice>
        </input>
    </fieldset>
    <row>
        <chart>
            <title>Top Server Groups </title>
            <searchString>
$deployment$ type=top-srvgrp
| rex mode=sed "s/group\d+/group/g" | rex mode=sed "s/pcent\d+/pcent/g" | rex mode=sed "s/,/ /g"
| rex field=_raw "group=(?&lt;group&gt;\w+)" max_match=20
| rex field=_raw "pcent=(?&lt;pcent&gt;\d+)" max_match=20 | eval fields = mvzip(group,pcent)
| mvexpand fields | rex field=fields "(?&lt;group&gt;\w+),(?&lt;pcent&gt;\d+)"
| table _time group pcent
| timechart limit=5 `myspan` avg(pcent) by group
            </searchString>
            <option name="charting.axisTitleY.visibility">visible</option>
            <option name="charting.axisX.scale">linear</option>
            <option name="charting.chart.stackMode">default</option>
            <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.axisTitleX.visibility">visible</option>
            <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
            <option name="charting.axisTitleX.text">Time ($mytz$)</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.scale">linear</option>
            <option name="resizable">true</option>
            <option name="charting.chart">line</option>
            <option name="charting.data.count">1500</option>
            <option name="charting.axisTitleY.text">Percent</option>
            <option name="charting.drilldown">off</option>
            <option name="link.inspectSearch.visible">true</option>
            <option name="link.openSearch.visible">true</option>
            <option name="charting.layout.splitSeries">0</option>
            <option name="charting.chart.style">shiny</option>
        </chart>
    </row>
    <row>
        <chart>
            <title>Top Source IP Addresses </title>
            <searchString>
$deployment$ type="top-sip"
| rex mode=sed "s/ip\d+/ip/g" | rex mode=sed "s/pcent\d+/pcent/g" | rex mode=sed "s/,/ /g"
| rex field=_raw "ip=(?&lt;ip&gt;[\S]+)" max_match=20
| rex field=_raw "pcent=(?&lt;pcent&gt;\d+)" max_match=20
| eval fields = mvzip(ip,pcent) | mvexpand fields
| rex field=fields "(?&lt;ip&gt;[\S]+),(?&lt;pcent&gt;\d+)"
| table _time ip pcent
| timechart limit=5 `myspan` avg(pcent) by ip
            </searchString>
            <option name="charting.axisTitleY.visibility">visible</option>
            <option name="charting.axisX.scale">linear</option>
            <option name="charting.chart.stackMode">default</option>
            <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.axisTitleX.visibility">visible</option>
            <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
            <option name="charting.axisTitleX.text">Time ($mytz$)</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.scale">linear</option>
            <option name="resizable">true</option>
            <option name="charting.chart">line</option>
            <option name="charting.data.count">1500</option>
            <option name="charting.axisTitleY.text">Percent</option>
            <option name="charting.drilldown">off</option>
            <option name="link.inspectSearch.visible">true</option>
            <option name="link.openSearch.visible">true</option>
            <option name="charting.layout.splitSeries">0</option>
            <option name="charting.chart.style">shiny</option>
        </chart>
        <chart>
            <title>Top Destination IP Addresses </title>
            <searchString>
$deployment$ type="top-dip"
| rex mode=sed "s/ip\d+/ip/g" | rex mode=sed "s/pcent\d+/pcent/g" | rex mode=sed "s/,/ /g"
| rex field=_raw "ip=(?&lt;ip&gt;[\S]+)" max_match=20
| rex field=_raw "pcent=(?&lt;pcent&gt;\d+)" max_match=20
| eval fields = mvzip(ip,pcent) | mvexpand fields
| rex field=fields "(?&lt;ip&gt;[\S]+),(?&lt;pcent&gt;\d+)"
| table _time ip pcent
| timechart limit=5 `myspan` avg(pcent) by ip
            </searchString>
            <option name="charting.axisTitleY.visibility">visible</option>
            <option name="charting.axisX.scale">linear</option>
            <option name="charting.chart.stackMode">default</option>
            <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.axisTitleX.visibility">visible</option>
            <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
            <option name="charting.axisTitleX.text">Time ($mytz$)</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.scale">linear</option>
            <option name="resizable">true</option>
            <option name="charting.chart">line</option>
            <option name="charting.data.count">1500</option>
            <option name="charting.axisTitleY.text">Percent</option>
            <option name="charting.drilldown">off</option>
            <option name="link.inspectSearch.visible">true</option>
            <option name="link.openSearch.visible">true</option>
            <option name="charting.layout.splitSeries">0</option>
            <option name="charting.chart.style">shiny</option>
        </chart>
    </row>
    <row>
        <chart>
            <title>Top Source Ports </title>
            <searchString>
$deployment$ type="top-sprt"
| rex mode=sed "s/port\d+/port/g" | rex mode=sed "s/pcent\d+/pcent/g" | rex mode=sed "s/,/ /g"
| rex field=_raw "port=(?&lt;port&gt;\d+)" max_match=20 | rex field=_raw "pcent=(?&lt;pcent&gt;\d+)" max_match=20
| eval fields = mvzip(port,pcent) | mvexpand fields
| rex field=fields "(?&lt;port&gt;\d+),(?&lt;pcent&gt;\d+)"
| table _time port pcent
| timechart limit=5 `myspan` avg(pcent) by port
            </searchString>
            <option name="charting.axisTitleY.visibility">visible</option>
            <option name="charting.axisX.scale">linear</option>
            <option name="charting.chart.stackMode">default</option>
            <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.axisTitleX.visibility">visible</option>
            <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
            <option name="charting.axisTitleX.text">Time ($mytz$)</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.scale">linear</option>
            <option name="resizable">true</option>
            <option name="charting.chart">line</option>
            <option name="charting.data.count">1500</option>
            <option name="charting.axisTitleY.text">Percent</option>
            <option name="charting.drilldown">off</option>
            <option name="link.inspectSearch.visible">true</option>
            <option name="link.openSearch.visible">true</option>
            <option name="charting.layout.splitSeries">0</option>
            <option name="charting.chart.style">shiny</option>
        </chart>
        <chart>
            <title>Top Destination Ports </title>
            <searchString>
$deployment$ type="top-dprt"
| rex mode=sed "s/port\d+/port/g" | rex mode=sed "s/pcent\d+/pcent/g" | rex mode=sed "s/,/ /g"
| rex field=_raw "port=(?&lt;port&gt;\d+)" max_match=20 | rex field=_raw "pcent=(?&lt;pcent&gt;\d+)" max_match=20
| eval fields = mvzip(port,pcent) | mvexpand fields | rex field=fields "(?&lt;port&gt;\d+),(?&lt;pcent&gt;\d+)"
| table _time port pcent
| timechart limit=5 `myspan` avg(pcent) by port
            </searchString>
            <option name="charting.axisTitleY.visibility">visible</option>
            <option name="charting.axisX.scale">linear</option>
            <option name="charting.chart.stackMode">default</option>
            <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.axisTitleX.visibility">visible</option>
            <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
            <option name="charting.axisTitleX.text">Time ($mytz$)</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.scale">linear</option>
            <option name="resizable">true</option>
            <option name="charting.chart">line</option>
            <option name="charting.data.count">1500</option>
            <option name="charting.axisTitleY.text">Percent</option>
            <option name="charting.drilldown">off</option>
            <option name="link.inspectSearch.visible">true</option>
            <option name="link.openSearch.visible">true</option>
            <option name="charting.layout.splitSeries">0</option>
            <option name="charting.chart.style">shiny</option>
        </chart>
    </row>
    <row>
        <chart>
            <title>Top TTL Values </title>
            <searchString>
$deployment$ type="top-ttl"
| rex mode=sed "s/ttl\d+/ttl/g" | rex mode=sed "s/pcent\d+/pcent/g" | rex mode=sed "s/,/ /g"
| rex field=_raw "ttl=(?&lt;ttl&gt;\d+)" max_match=20
| rex field=_raw "pcent=(?&lt;pcent&gt;\d+)" max_match=20
| eval fields = mvzip(ttl,pcent) | mvexpand fields
| rex field=fields "(?&lt;ttl&gt;\d+),(?&lt;pcent&gt;\d+)"
| table _time ttl pcent | timechart limit=5 `myspan` avg(pcent) by ttl
            </searchString>
            <option name="charting.axisTitleY.visibility">visible</option>
            <option name="charting.axisX.scale">linear</option>
            <option name="charting.chart.stackMode">default</option>
            <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.axisTitleX.visibility">visible</option>
            <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
            <option name="charting.axisTitleX.text">Time ($mytz$)</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.scale">linear</option>
            <option name="resizable">true</option>
            <option name="charting.chart">line</option>
            <option name="charting.data.count">1500</option>
            <option name="charting.axisTitleY.text">Percent</option>
            <option name="charting.drilldown">off</option>
            <option name="link.inspectSearch.visible">true</option>
            <option name="link.openSearch.visible">true</option>
            <option name="charting.layout.splitSeries">0</option>
            <option name="charting.chart.style">shiny</option>
        </chart>
        <chart>
            <title>Top IP Packet Lengths </title>
            <searchString>
$deployment$ type="top-length"
| rex mode=sed "s/length\d+/length/g" | rex mode=sed "s/pcent\d+/pcent/g" | rex mode=sed "s/,/ /g"
| rex field=_raw "length=(?&lt;length&gt;\d+)" max_match=20
| rex field=_raw "pcent=(?&lt;pcent&gt;\d+)" max_match=20
| eval fields = mvzip(length,pcent) | mvexpand fields
| rex field=fields "(?&lt;length&gt;\d+),(?&lt;pcent&gt;\d+)"
| table _time length pcent | timechart limit=5 `myspan` avg(pcent) by length
            </searchString>
            <option name="charting.axisTitleY.visibility">visible</option>
            <option name="charting.axisX.scale">linear</option>
            <option name="charting.chart.stackMode">default</option>
            <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.axisTitleX.visibility">visible</option>
            <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
            <option name="charting.axisTitleX.text">Time ($mytz$)</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.scale">linear</option>
            <option name="resizable">true</option>
            <option name="charting.chart">line</option>
            <option name="charting.data.count">1500</option>
            <option name="charting.axisTitleY.text">Percent</option>
            <option name="charting.drilldown">off</option>
            <option name="link.inspectSearch.visible">true</option>
            <option name="link.openSearch.visible">true</option>
            <option name="charting.layout.splitSeries">0</option>
            <option name="charting.chart.style">shiny</option>
        </chart>
   </row>
</form>
